# ChangeLog for squashmount

*squashmount-14.0.0
	Martin Väth <martin at mvath.de>:
	- Support KILL => -1 (and --kill-or-resquash)
	- New short options -R -l -L
	- Fix many typos in documentation

*squashmount-13.0.0
	Martin Väth <martin at mvath.de>:
	- Require perl-5.22 to use the convenient qr{...}n feature; otherwise,
	  perl-5.12 would be sufficient (// was the newest feature used)
	- Rewrite documentation for the qr{...}n feature
	- Serious bugfix: with current versions of File::Find, symlinks
	  had mistakenly been followed for the size calculation
	- Support String::ShellQuote for improved output
	- Internal: new comment style

*squashmount-12.2.1
	Martin Väth <martin at mvath.de>:
	- Bump to play a round of the systemd insanity game "all users:
	  change your configs since our previous ideas were stupid again"

*squashmount-12.2.0
	Martin Väth <martin at mvath.de>:
	- Support CHMOD_DIR and CHOWN_DIR

*squashmount-12.1.1
	Martin Väth <martin at mvath.de>:
	- Add /etc/nut/killpower to $killpower by default

*squashmount-12.1.0
	Martin Väth <martin at mvath.de>:
	- Support option --order (-o) to override @order
	- Support the value "bind" in @order to skip error message

*squashmount-12.0.1
	Martin Väth <martin at mvath.de>:
	- Remove redundant quoting in shell scripts

*squashmount-12.0.0
	Martin Väth <martin at mvath.de>:
	- Introduce --lsof and $lsof.
	- Note that --lsof=0 should be passed in init-scripts with stop
	- Now --lazy and $lazy are non-binary, but can be 0, 1, or -1.
	  However, -1 (*only* lazy) is not recommended
	- On frequent request introduce magic meaning of THRESHOLD -2
	  (shortcut: --force-squash)
	- Reformulate some passages of documentation (e.g. "gentoo repository"
	  instead of "portage tree")

*squashmount-11.0.1
	Martin Väth <martin at mvath.de>:
	- Fix error output in config file parsing

*squashmount-11.0.0
	Martin Väth <martin at mvath.de>:
	- Provide etc/portage/repo.postsync.d/50-squashmount-gentoo
	  and instructions for a special treatment of the mount point
	  "gentoo" in connection with portage's sync-type = squashdelta
	- WARNING: The above file treats the mount-point "gentoo" specially!
	  Do not use that name as a mount-point if you install this file but
	  do not inted to use portage's sync-type = squashdelta!
	- Fix some typos in help/example texts

*squashmount-10.1.0
	Martin Väth <martin at mvath.de>:
	- Support $before_{u,mount} $after_{u,mount}

*squashmount-10.0.2
	Martin Väth <martin at mvath.de>:
	- Fix etc/revdep-rebuild

*squashmount-10.0.1
	Martin Väth <martin at mvath.de>:
	- internal: prefer each() over index bookkeeping

*squashmount-10.0.0
	Martin Väth <martin at mvath.de>:
	- IMPORTANT: New default for COMPRESSION is lz4.
	  lz4 must be enabled for squashfs when you use the new default!
	  This is possible only with linux-3.19 or newer!
	- systemd is no longer officially supported, although it might work
	  for you. Reasons are explained in the README
	- Support $resquash_on_start and per mount-point RESQUASH_ON_START
	- Support $rm_rundir
	- Support $rm_dir, $rm_changes, $rm_workdir, $rm_readonly
	  and per mount-point RM_DIR, RM_CHANGES, RM_WORKDIR, RM_READONLY
	- Provide etc/revdep-rebuild

*squashmount-9.0.1
	Martin Väth <martin at mvath.de>:
	- Use openrc-run instead of deprecated runscript

*squashmount-9.0.0
	Martin Väth <martin at mvath.de>:
	- Support overlay of linux kernel 3.18.
	  Note the new name "overlay" in contrast to "overlayfs" which
	  is available only for older linux kernels.
	  squashmount uses "overlay" and "overlayfs" throughout to distinguish.
	- Fix logic for @order to work as documented
	- Fix $obsolete_overlay handling in config
	- Fix error in case of illegal cmd

*squashmount-8.7.9
	Martin Väth <martin at mvath.de>:
	- Fix comments in example configuration, see
	  https://github.com/vaeth/squashmount/issues/4
	  Thanks to Arnaudv6 for reporting

*squashmount-8.7.8
	Martin Väth <martin at mvath.de>:
	- Update description of recommended squashfs-tools patch

*squashmount-8.7.7
	Martin Väth <martin at mvath.de>:
	- Use gnu_getopt

*squashmount-8.7.6
	Martin Väth <martin at mvath.de>:
	- Support modprobe loop to work around a new udev bug

*squashmount-8.7.5
	Martin Väth <martin at mvath.de>:
	- systemd: set timout to infinity and document how to change it
	- zsh completion: Fix _tags mask test

*squashmount-8.7.4
*squashmount-8.7.3
	Martin Väth <martin at mvath.de>:
	- require Pod::Usage only if necessary; don't use version
	- Replace 'EOF' by 1 to avoid stupid new perl warning

*squashmount-8.7.1
	Martin Väth <martin at mvath.de>:
	- Use perl-5.12 versioning, dotted-decimal version format
	- Require correct minimal versions of perl and its modules

*squashmount-8.7
	Martin Väth <martin at mvath.de>:
	- Provide sample find_cruft.d
	- Cosmetical code cleanup

*squashmount-8.6
	Martin Väth <martin at mvath.de>:
	- Fix IO::Uncompress::Gunzip handling (regression from squashmount-7.6)
	- Treat nonexistent IO::Uncompress::Gunzip like unreadable config

*squashmount-8.5
	Martin Väth <martin at mvath.de>:
	- Be graceful if stored directories are removed: Recreate from scratch
	- take care if -X returns undef

*squashmount-8.4
	Martin Väth <martin at mvath.de>:
	- Create parent directories before calling mksquashfs. This fixes
	  "squashmount create" with standard_mount and nonexistent DIR.mount
	- internal: omit & for function export

*squashmount-8.3
	Martin Väth <martin at mvath.de>:
	- Fix some typos in manpage/examples introduced in 8.2
	- Cosmetical code rearrangements

*squashmount-8.2
	Martin Väth <martin at mvath.de>:
	- use Exporter instead of manual manipulation of symbol glob table
	- more compatible indirect call syntax

*squashmount-8.1
	Martin Väth <martin at mvath.de>:
	- Remove $rundir and $query from advanced configuration, and expose
	  less details than in 8.0 to ensure stability with future versions.
	  Instead:
	- Provide have_stored_data(mountpoint)
	- Introduce callback functionality to store user-defined data
	- Introduce $storing (with side effects! Change also $locking!)
	- export output functions info, warning, error, errorinfo, fatal
	  to configuration file (and use them for errors in that file)
	- Full custom example with a "variable" custom FILE
	- code cleanup: always use explicit package names, no imports

*squashmount-8.0
	Martin Väth <martin at mvath.de>:
	- Add possibilities for advanced configuration like conditional
	  mount-points (e.g. for cds),
	- Add options -a --arg
	- Provide @ARGV, $command, $query, $rundir for configuration file
	- manpage: Add section "ADVANCED CONFIGURATION"
	- Add example to etc/squashmount.pl about CD mount-points
	- Add example about conditionals based on host-name
	- Improve parsing of configuration file
	- Document that configuration files must finish with a true expression

*squashmount-7.12
	Martin Väth <martin at mvath.de>:
	- Introduce a 4th verbose level to make external tools more verbose
	- Do not suppress output in 3rd verbose level
	- Further minor code cleanup

*squashmount-7.11
	Martin Väth <martin at mvath.de>:
	- code cleanup (prefer // over defined())

*squashmount-7.10
	Martin Väth <martin at mvath.de>:
	- Fix @umount{,_ro} and UMOUNT{,_RO} (they had swapped their meaning)

*squashmount-7.9
	Martin Väth <martin at mvath.de>:
	- Include @umount{,_ro} in examples

*squashmount-7.8
	Martin Väth <martin at mvath.de>:
	- Introduce UMOUNT{,_RO}, @umount{,_ro}, --umount{,-ro}

*squashmount-7.7
	Martin Väth <martin at mvath.de>:
	- Fix wrong cutting of directories (regression of squashmount-7.6)
	- Use File::Spec->splitpath (should improve dir handling compatibility)

*squashmount-7.6
	Martin Väth <martin at mvath.de>:
	- Interpret strings as multiline regexp
	- More compatible directory handling in threshold_dir
	- Consistent regexp syntax: m{}, qr{}, or s{}{}
	- Slight speedup by avoiding redundant return statements

*squashmount-7.5
	Martin Väth <martin at mvath.de>:
	- Improve/fix some regexes; quote newlines correctly

*squashmount-7.4
	Martin Väth <martin at mvath.de>:
	- Fix behaviour if directories with nonexisting parents are specified

*squashmount-7.3
*squashmount-7.2
	Martin Väth <martin at mvath.de>:
	- Check args in &added_hash() and &standard_mount() (>=perl-5.20)

*squashmount-7.1
	Martin Väth <martin at mvath.de>:
	- Use type 'overlayfs-obsolete' for old overlayfs (without workdir)
	- Clean WORKDIR on every umount of an overlayfs (and only then)
	- Create WORKDIR only if really required
	- Introduce $obsolete_overlayfs = 'force' to skip creation of WORKDIR
	- Remove $no_workdir (unwisely introduced in squashmount-7.0)

*squashmount-7.0
	Martin Väth <martin at mvath.de>:
	- WARNING: The meaning of &standard_mount() has changed!
	  Paths are now dir/changes dir/workdir dir/readonly dir/dir.sfs
	  You should reorganize your directory structure to reflect that!
	  The reason is that WORKDIR is mandatory with new overlayfs.
	- Support current overlayfs (WORKDIR)

*squashmount-6.3
	Martin Väth <martin at mvath.de>:
	- Introduce -p/--processors, -m/--mem and $processors, $mem defaults

*squashmount-6.2
	Martin Väth <martin at mvath.de>:
	- Use the flexible $mksquash_verbose, --mksquash-verbose strings
	  instead of the previous $squash_verbose, --squash-verbose numbers.
	  To ease transition for users, currently an error is reported if
	  the now unsupported $squash_verbose is still set.

*squashmount-6.1
	Martin Väth <martin at mvath.de>:
	- Change meaning of squash_verbose
	  Default prefers mksquashfs -quiet if available

*squashmount-6.0a
	Martin Väth <martin at mvath.de>:
	- Revert to COMPRESSION=xz default until lz4 is supported by
	  mainstream kernel

*squashmount-6.0
	Martin Väth <martin at mvath.de>:
	- Support COMPOPT_* to allow setting algorithm-specific option.
	- Default to COMPRESSION=lz4 (this is the reason for new major version)
	- Default to COMPOPT_LZ4=-Xhc
	- squashmount -vv list now outputs effective mksquashfs options
	- Fix handling of mksquash compression option.

*squashmount-5.0
	Martin Väth <martin at mvath.de>:
	- Use -always-use-fragments by default
	- Introduce DEFAULT_FRAGMENTS to avoid -always-use-fragments
	- Improve printed output of shell commands
	- Fix treatment of redirects
	- Provide example of special mksquash compression option

*squashmount-4.5
*squashmount-4.4
	Martin Väth <martin at mvath.de>:
	- Add sanity check before deleting DIR after first creation of
	  squashfile, see https://github.com/vaeth/squashmount/issues/1

*squashmount-4.3
	Martin Väth <martin at mvath.de>:
	- Add /etc/nosquash to $killpower default. Fix reference to --keep

*squashmount-4.2
	Martin Väth <martin at mvath.de>:
	- Fix severely misleading typo on manpage for File::Temp::newdir

*squashmount-4.1
	Martin Väth <martin at mvath.de>:
	- Support $killpower (/etc/killpower) for fast emergency shutdown

*squashmount-4.0
	Martin Väth <martin at mvath.de>:
	- Introduce --backup, --no-backup, --tempdir, --compresssion
	  for temporarily overriding configuration, e.g. with set/restore
	- Treat BACKUP as appendix if not an absolute path

*squashmount-3.7
	Martin Väth <martin at mvath.de>:
	- Make clearer that etc/squashmount.pl is only an example
	- Fix typo in getpwnam() getgrnam() calls in example configuration

*squashmount-3.6
	Martin Väth <martin at mvath.de>:
	- Introduce CHMOD, CHOWN; default to CHMOD = 0644

*squashmount-3.5
*squashmount-3.4
	Martin Väth <martin at mvath.de>:
	- No locking default for status and print-*
	- zsh completion: Use --no-locking when calling squashmount

*squashmount-3.3
*squashmount-3.2
	Martin Väth <martin at mvath.de>:
	- Improve documentation

*squashmount-3.1
*squashmount-3.0
	Martin Väth <martin at mvath.de>:
	- modprobe modules by default
	- Support flags !, !!, ?, ??, # in @order
	- Support $modprobe_squashfs
	- Set @order to empty string if not needed
	- Use qw(...) in examples where it makes sense
	- standard_mount() and added_hash() can now be called without &

*squashmount-2.10
	Martin Väth <martin at mvath.de>:
	- Support FILL and FILLFUNC

*squashmount-2.9
	Martin Väth <martin at mvath.de>:
	- fix tmpfiles.d content which caused sometimes breakage with systemd
	- fix systemd/openrc deps to avoid most problems even with "D" setting
	- document emergency case explicitly
	- improve behaviour in emergency case (getting DIR)
	- cosmetical code cleanup

*squashmount-2.8
	Martin Väth <martin at mvath.de>:
	- fix: --error and --fatal can work together
	- fix restart: postpone forget, not releasing lock too early
	- Improve error handling for writing to /run/squashmount

*squashmount-2.7
	Martin Väth <martin at mvath.de>:
	- Introduce --locking and $locking and make it default
	- New check command
	- Add tmpfiles.d
	- squashmount -fI {u,}mount now even continues after error
	- Allow -f for status and print-... and improve results without -f

*squashmount-2.6
	Martin Väth <martin at mvath.de>:
	- Require -f for restart to forget+start an umounted mount-point
	- Introduce --ignore-state to deal better with exceptional
	  situations caused by bugs (in squashmount or its config) or
	  by manual interfering

*squashmount-2.5
	Martin Väth <martin at mvath.de>:
	- Fix severe typo which caused umount to not save its state:
	  Regression introduced in squashmount-2.3 (=squashmount-2.4)

*squashmount-2.4
*squashmount-2.3
	Martin Väth <martin at mvath.de>:
	- Fix serious bug with restart command (forgetting despite mounting)
	- Change of the /run/squashmount format (MOUNT_RW is now part of TYPE).
	  Be aware that this can lead to problems for mount-points mounted
	  with an older version of squashmount!
	- Never touch /run/squashmount for info (status, print-...) commands
	- Deal better with half-mounted/half-umounted directories (i.e. after
	  fatal mount/umount failures)
	- More beautiful colored output if TERM::ANSIColor is available
	- New options -c -C (--color --no-color), --star, --no-star
	- Make most print-* commands return reasonable results also for
	  mount-points never mounted
	- Rename option --pass-directory into --pass-dir
	- Let print-... produce now more verbose output by default;
	  honour --separator only with -q
	- Let print-threshold without -v or -q print the human-readable form
	- Introduce --{no,}fatal and make --fatal default for {re,}start, stop
	- internal: use File::Spec for more compatibility
	- internal: make wanted function local to threshold_dir, using closures

*squashmount-2.2
	Martin Väth <martin at mvath.de>:
	- Remember paths; check for existence with File::Which
	- Fix usage of unionfs-fuse and of unionfs. Thanks to yoshi314 for
	  reporting: http://forums.gentoo.org/viewtopic-t-465367-start-248.html
	- Require -f on stop for umounted points to avoid accidental forget
	  of a semi-mounted state (could happen in case of certain bugs in
	  /etc/squashmount.pl or squashmount)
	- Use bigint for sizes/thresholds to make it reliable on 32 bit systems
	- Add more sanity checks

*squashmount-2.1
	Martin Väth <martin at mvath.de>:
	- Fix division by 0 on 32 bit systems

*squashmount-2.0
	Martin Väth <martin at mvath.de>:
	- Introduce &standard_mount, &added_hash config helpers,
	  remove misguided &standard_hash
	- Let start, stop, restart differ from mount, umount, remount
	- Introduce a separate create command
	- Introduce reset, forget, --reset
	- internal: make $current, $user_config global
	- internal: reorder to allow prototyping if desired,
	  but avoid it as it makes no sense in perl5

*squashmount-1.1
	Martin Väth <martin at mvath.de>:
	- Fix handling of BACKUP
	- various cosmetical fixes

*squashmount-1.0
	Martin Väth <martin at mvath.de>:
	- Improve documentation
	- Fix rounding
	- Fix sanity checks
	- Try to skip remount

*squashmount-0.01
	Martin Väth <martin at mvath.de>:
	- Initial implementation, using some ideas of the squash_dir project

